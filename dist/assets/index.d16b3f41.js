var s=Object.defineProperty;var c=(i,t,o)=>t in i?s(i,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[t]=o;var n=(i,t,o)=>(c(i,typeof t!="symbol"?t+"":t,o),o);const g=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(r){if(r.ep)return;r.ep=!0;const a=o(r);fetch(r.href,a)}};g();class b{constructor(t){n(this,"view");n(this,"canvasWidth");n(this,"canvasHeight");this.view=t}downloadImage(){this.view.downloadImage()}uploadImage(t){this.view.uploadImage(t)}writeLine(t,o,e){this.view.writeLine(t,o,e)}setColor(t){this.view.setPencilColor(t),this.view.updateCurrentColor(t),this.view.setInputColor(t)}setThickness(t){this.view.setPencilThickness(+t)}setCanvasWidth(t){this.canvasWidth=t,this.view.setCanvasWidth(this.canvasWidth),this.view.setCanvasWidthText(this.canvasWidth)}setCanvasHeight(t){this.canvasHeight=t,this.view.setCanvasHeight(this.canvasHeight),this.view.setCanvasHeightText(this.canvasHeight)}setMouseCoordinatesText(t,o){this.view.setMouseCoordinatesText(t,o)}}var d=(i=>(i.pencil="pencil",i.colorPicker="colorPicker",i.eraser="eraser",i.text="text",i.fillColor="fillColor",i))(d||{});class f{constructor(t,o){n(this,"model");n(this,"view");n(this,"lastEvent");n(this,"canvas",document.getElementById("canvas"));n(this,"mainContent",document.querySelector(".main-content"));n(this,"canvasWrap",document.querySelector(".canvas-wrap"));this.model=t,this.view=o,this.initCanvasResizeEvents(),this.initBottomPanelEvents(),this.initTopPanelEvents()}initTopPanelEvents(){this.setToolEvent("pencil"),document.querySelectorAll(".top-panel  .tools img").forEach(t=>{t.addEventListener("click",()=>{let o=d[t.getAttribute("data-tool-name")];this.setToolEvent(o)})}),document.querySelector(".top-panel .thickness__range").addEventListener("change",t=>{const o=t.target;this.model.setThickness(o.value)}),document.querySelector(".top-panel .palette__color-input").addEventListener("change",t=>{const o=t.target;this.model.setColor(o.value)}),document.querySelector(".top-panel .file .download").addEventListener("click",()=>{this.model.downloadImage()}),document.querySelector(".top-panel .file .upload input").addEventListener("change",t=>{this.model.uploadImage(t.target.files[0])}),this.model.setColor("#000000")}setToolEvent(t){t==="pencil"&&(document.documentElement.classList.add("pencil-cursor"),document.querySelector(".top-panel img[data-tool-name='pencil']").classList.add("active"),this.canvas.onmousedown=o=>{this.model.writeLine(o.offsetX,o.offsetY,!0),this.canvas.onmousemove=e=>{this.model.writeLine(e.offsetX,e.offsetY,!1)},this.canvas.onmouseup=()=>{this.canvas.onmousemove=null}})}initBottomPanelEvents(){this.canvas.addEventListener("mousemove",o=>{this.model.setMouseCoordinatesText(o.offsetX,o.offsetY)}),this.canvas.addEventListener("mouseleave",()=>{this.model.setMouseCoordinatesText(-1,-1)});const t=100;this.model.setCanvasWidth(document.documentElement.clientWidth-t),this.model.setCanvasHeight(600)}initCanvasResizeEvents(){let t=document.querySelector(".canvas-wrap .right-resize-btn"),o=document.querySelector(".canvas-wrap .bottom-resize-btn"),e=document.querySelector(".canvas-wrap .bottom-right-resize-btn");o.addEventListener("mousedown",()=>{r("bottom")}),t.addEventListener("mousedown",()=>{r("right")}),e.addEventListener("mousedown",()=>{r("bottom-right")});let r=a=>{this.view.setResizeCursor(a);let l=m=>{(a==="right"||a==="bottom-right")&&this.model.setCanvasWidth(m.pageX-this.canvasWrap.getBoundingClientRect().x),(a==="bottom"||a==="bottom-right")&&this.model.setCanvasHeight(m.pageY-this.canvasWrap.getBoundingClientRect().y)};this.mainContent.onmousemove=m=>{l(m)},this.mainContent.onmouseup=m=>{l(m),this.view.removeResizeCursor(a),this.mainContent.onmouseup=null,this.mainContent.onmousemove=null}}}}class u{constructor(){n(this,"canvasNode",document.getElementById("canvas"));n(this,"ctx");n(this,"canvasSettings",{});n(this,"canvasSettingsValues",["lineWidth","fillStyle","strokeStyle"]);let t=document.getElementById("canvas");this.ctx=t.getContext("2d")}downloadImage(){let t=document.createElement("a");document.body.appendChild(t),t.href=this.canvasNode.toDataURL(),t.download="canvs image.png",t.click(),document.body.removeChild(t)}uploadImage(t){let o=URL.createObjectURL(t),e=new Image;e.src=o,e.onload=()=>{this.ctx.drawImage(e,0,0)}}saveCanvasSettings(){for(let t of this.canvasSettingsValues)this.canvasSettings[t]=this.ctx[t]}restoreCanvasSettings(){for(let t of this.canvasSettingsValues)this.ctx[t]=this.canvasSettings[t]}writeLine(t,o,e){e?this.ctx.moveTo(t,o):(this.ctx.lineTo(t,o),this.ctx.stroke())}drawStartFakeCanvas(){return this.saveCanvasSettings(),this.canvasNode.toDataURL("image/png")}drawEndFakeCanvas(t){var o=document.createElement("img");o.src=t,o.onload=()=>{this.ctx.drawImage(o,0,0)},this.restoreCanvasSettings()}setPencilColor(t){this.ctx.beginPath(),this.ctx.strokeStyle=t}setInputColor(t){document.querySelector(".top-panel .palette__color-input").value=t}updateCurrentColor(t){document.querySelector(".current-color__color").setAttribute("style",`background: ${t}`)}setPencilThickness(t){let o;switch(t){case 1:o=1;break;case 2:o=3;break;case 3:o=5;break;case 4:o=10;break}this.ctx.beginPath(),this.ctx.lineWidth=o}setCanvasWidth(t){let o=this.drawStartFakeCanvas();this.canvasNode.setAttribute("width",t.toString()),this.drawEndFakeCanvas(o)}setCanvasHeight(t){let o=this.drawStartFakeCanvas();this.canvasNode.setAttribute("height",t.toString()),this.drawEndFakeCanvas(o)}setCanvasWidthText(t){document.querySelector(".bottom-panel .canvas-size .width").textContent=t.toString()}setCanvasHeightText(t){document.querySelector(".bottom-panel .canvas-size .height").textContent=t.toString()}setMouseCoordinatesText(t,o){let e=document.querySelector(".mouse-coordinates");t===-1&&o===-1?e.innerHTML="":e.innerHTML=`${t}, ${o}`}setResizeCursor(t){t==="right"?document.body.classList.add("ew-resize"):t==="bottom"?document.body.classList.add("ns-resize"):t==="bottom-right"&&document.body.classList.add("nwse-resize")}removeResizeCursor(t){t==="right"?document.body.classList.remove("ew-resize"):t==="bottom"?document.body.classList.remove("ns-resize"):t==="bottom-right"&&document.body.classList.remove("nwse-resize")}}let p=new u,x=new b(p);new f(x,p);
